@import "tailwindcss";
@import "@fontsource-variable/jetbrains-mono";

@theme {
  --font-mono: var(--font-mono);
  
  --color-primary: var(--primary);
  --color-secondary: var(--secondary);
  --color-accent: var(--accent);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  
  --radius-lg: var(--radius-lg);
  --radius-sm: var(--radius-sm);
  
  --breakpoint-xs: 30rem;
  --breakpoint-lg: 56.25rem;
}

:root {
  --bg-color: #ffffff; /* Fallback */
}

body {
  background-color: var(--background);
  color: var(--secondary);
  font-family: var(--font-mono);
  line-height: var(--line-spacing);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Mobile zoom adjustment for better fit on small screens */
@media (width < 30rem) {
  html {
    font-size: 16px; /* Reduce base font size from default 16px */
  }
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 5px;
  height: 5px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: var(--foreground);
  border-radius: var(--radius-lg);
}
::-webkit-scrollbar-thumb:hover {
  background: var(--primary);
}

/* Utilities */
.btn-toolbar {
  @apply h-9 px-3 rounded-[var(--radius-sm)] text-sm font-semibold bg-transparent border-2 border-primary text-primary hover:bg-foreground transition-colors cursor-pointer;
}

.btn-icon {
  @apply p-2 rounded-[var(--radius-sm)] text-secondary hover:bg-foreground transition-colors cursor-pointer;
}

/* Sidebar Container Query Logic */
@container cell-sidebar (max-height: 125px) {
  .sidebar-inner-auto-center {
    position: absolute !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    margin-top: 0 !important;
    margin-bottom: 0 !important;
    width: 100% !important;
  }
}

/* Milkdown & Prose Overrides */
.milkdown-editor-wrapper {
  @apply min-h-12.5;
}
.milkdown .editor {
  @apply bg-transparent text-secondary font-mono outline-none ring-0 border-none;
  caret-color: var(--accent);
}
.milkdown .editor:focus {
  @apply outline-none ring-0 border-none;
}

/* Fix Tailwind resets for Milkdown content and Prose (Shared styles) */
.milkdown .editor ul,
.prose ul {
    list-style-type: disc !important;
    padding-left: 1.5rem !important;
    margin-top: var(--block-margin) !important;
    margin-bottom: var(--block-margin) !important;
    margin-left: 1.5rem !important;
}
.milkdown .editor ol,
.prose ol {
    list-style-type: decimal !important;
    /* Reverting left padding/margin alignment as requested */
    padding-left: 1.5rem !important; 
    margin-top: var(--block-margin) !important;
    margin-bottom: var(--block-margin) !important;
    margin-left: 2.2rem !important;
}
.milkdown .editor li::marker,
.prose li::marker {
    color: var(--primary);
    font-weight: bold;
}

/* Remove left margin for nested lists */
.milkdown .editor li > ul,
.milkdown .editor li > ol,
.prose li > ul,
.prose li > ol {
    margin-left: 0.5rem !important;
}

/* Modern Table Styling for Editor and Prose */
.milkdown .editor table,
.prose table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 1.25em 0 !important;
    border: 2px solid color-mix(in srgb, var(--secondary) 40%, transparent);
    border-radius: var(--radius-sm);
    overflow: hidden;
}

.milkdown .editor th,
.milkdown .editor td,
.prose th,
.prose td {
    padding: 0.6rem 0.8rem;
    text-align: left;
    position: relative;
}

/* Header Styles */
.milkdown .editor th,
.prose th {
    background-color: color-mix(in srgb, var(--accent) 10%, transparent);
    font-weight: 600;
    color: var(--secondary);
    border-bottom: 2px solid color-mix(in srgb, var(--accent) 10%, transparent);
    border-right: 2px solid color-mix(in srgb, var(--accent) 10%, transparent);
}

/* Body Cell Styles */
.milkdown .editor td,
.prose td {
    border-bottom: 2px solid color-mix(in srgb, var(--accent) 10%, transparent);
    border-right: 2px solid color-mix(in srgb, var(--accent) 10%, transparent);
}

/* Remove outer borders from cells to respect table radius */
.milkdown .editor th:last-child,
.milkdown .editor td:last-child,
.prose th:last-child,
.prose td:last-child {
    border-right: none;
}

.milkdown .editor tr:last-child td,
.prose tr:last-child td {
    border-bottom: none;
}

.milkdown .editor code {
    font-family: var(--font-mono);
    font-size: 0.875em;
    background-color: color-mix(in srgb, var(--foreground) 20%, transparent);
    padding: 0.2em 0.4em;
    border-radius: var(--radius-sm);
}

/* Fix Tailwind resets for Prose (Presentation Mode) - Removed duplicates, now shared above */
.prose code {
    font-family: var(--font-mono) !important;
    font-size: 0.875em !important;
    background-color: color-mix(in srgb, var(--accent) 8%, transparent);
    padding: 0.2em 0.5em;
    border-radius: var(--radius-sm);
    color: color-mix(in srgb, var(--secondary) 75%, transparent) !important;
    font-weight: normal !important;
}

/* Code blocks (pre > code) - distinct block styling */
.prose pre {
    background-color: color-mix(in srgb, var(--accent) 8%, transparent) !important;
    border: 1px solid color-mix(in srgb, var(--foreground) 15%, transparent);
    border-radius: var(--radius-sm);
    padding: 1em !important;
    margin: 1em 0 !important;
    overflow-x: auto;
}
.prose pre code {
    background-color: transparent !important;
    padding: 0 !important;
    border-radius: 0 !important;
    font-family: var(--font-mono) !important;
    font-size: 0.875em !important;
    color: color-mix(in srgb, var(--secondary) 75%, transparent) !important;
    font-weight: normal !important;
}

/* Remove backticks from code in prose */
.prose code::before,
.prose code::after {
    content: none !important;
}

.milkdown-theme-nord {
    --nord0: var(--background) !important;
    --nord4: var(--secondary) !important;
    --nord6: var(--secondary) !important;
    --nord10: var(--primary) !important; /* Headers usually use nord10 in this theme */
}

/* Prose headers override */
.prose :where(h1) {
    color: var(--header-color-1) !important;
    font-weight: bold !important;
    margin-bottom: var(--header-margin-bottom) !important;
}
.prose :where(h2) {
    color: var(--header-color-2) !important;
    font-weight: bold !important;
    margin-bottom: var(--header-margin-bottom) !important;
}
.prose :where(h3) {
    color: var(--header-color-3) !important;
    font-weight: bold !important;
    margin-bottom: var(--header-margin-bottom) !important;
}
.prose :where(h4) {
    color: var(--header-color-4) !important;
    font-weight: bold !important;
    margin-bottom: var(--header-margin-bottom) !important;
}
.prose :where(h5, h6) {
    color: var(--header-color-4) !important;
    font-weight: bold !important;
    margin-bottom: calc(var(--header-margin-bottom) * 0.25) !important;
}

/* Milkdown headers override */
.milkdown .editor :where(h1, h2, h3, h4) {
    margin-bottom: var(--header-margin-bottom) !important;
}

/* Prose text color */
.prose {
    color: var(--secondary) !important;
    font-size: var(--font-size-base) !important;
}
.prose h4 {
    font-size: calc(var(--font-size-base) + var(--font-size-delta)) !important;
}
.prose h3 {
    font-size: calc(var(--font-size-base) + 2 * var(--font-size-delta)) !important;
}
.prose h2 {
    font-size: calc(var(--font-size-base) + 3 * var(--font-size-delta)) !important;
}
.prose h1 {
    font-size: calc(var(--font-size-base) + 4 * var(--font-size-delta)) !important;
}
.prose strong {
    color: var(--primary) !important;
}

/* Blockquote styling */
.prose blockquote,
.milkdown .editor blockquote {
    border-left: 3px solid var(--primary) !important;
    padding-left: 2rem !important;
    margin-top: var(--block-margin) !important;
    margin-bottom: var(--block-margin) !important;
    margin-left: 1px !important;
    color: var(--secondary) !important;
    font-style: normal;
}

 /* Image Styling */
.prose img,
.milkdown .editor img {
    border-radius: var(--radius-sm) !important;
    border: 2px solid color-mix(in srgb, var(--secondary) 40%, transparent);
}

/* Section Scoping Logic */
.section-scope[data-level="1"] { --primary: var(--header-color-1) !important; --color-primary: var(--header-color-1) !important; }
.section-scope[data-level="2"] { --primary: var(--header-color-2) !important; --color-primary: var(--header-color-2) !important; }
.section-scope[data-level="3"] { --primary: var(--header-color-3) !important; --color-primary: var(--header-color-3) !important; }
.section-scope[data-level="4"] { --primary: var(--header-color-4) !important; --color-primary: var(--header-color-4) !important; }

/* Cell List Transition Group */
.cell-list-move {
  transition: transform 0.3s ease-in-out;
}

.cell-list-enter-active,
.cell-list-exit-active {
  transition: opacity 0.3s, transform 0.3s;
}

.cell-list-enter-from,
.cell-list-exit-to {
  opacity: 0;
  transform: translateX(20px);
}

/* Remove bottom margin from last header to prevent double spacing */
.prose > :where(h1, h2, h3, h4):last-child,
.prose > .section-scope:last-child > :where(h1, h2, h3, h4):last-child,
.milkdown .editor > :where(h1, h2, h3, h4):last-child {
    margin-bottom: 0 !important;
}